<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Battleship - Play</title>
</head>
<body>
    <h1>Play</h1>
    <script type="text/javascript">

    var gamestate = Array(100).fill(0);

    var background = new Image();
    background.src= "water.png";
    nuage = new Image();
    nuage.src = "Claudy.png";
    explosion = new Image();
    explosion.src = "Explosion.jpg";
    var canvas;
    var context;
   function charger(){
   alert("lol");
    canvas = document.getElementById("field");
    context = canvas.getContext("2d");

    draw();


    canvas.style.display = "block";
    }
    function draw(){
       context.drawImage(background,0,0,500,500);

        var x;
        var y;

        for(var id=0;id<100;id++)
        {
            switch(gamestate[id]){

            case 0:
            //print nuage
            context.drawImage(nuage,((id%10))*50,Math.floor(id/10)*50,50,50);
                break;
            case 1:
            //print explosion
             context.drawImage(explosion,((id%10))*50,Math.floor(id/10)*50,50,50);
                break;
            //case 2:
            //print nothing


            }
            //print the corresponding picture on screen
            if(gamestate[id] ==0)
                //ici faut avoir un truc pour choisir quel image
                context.drawImage(nuage,(x)*50,(y)*50,50,50);

        }
    }
    function shoot(){
    //get mouse coord
    var mx = event.clientX-  document.getElementById("field").offsetLeft -  document.getElementById("parent").offsetLeft + document.body.scrollLeft;
    var my = event.clientY- document.getElementById("field").offsetTop -  document.getElementById("parent").offsetTop + document.body.scrollTop;



    //convertir en identitÃ© grid?
    var id = Math.floor(mx/50) + Math.floor(my/50)*10;
    alert(id);

    //TODO: do ajax to send grid identity
    var request = new XMLHttpRequest();

    request.onreadystatechange = function() {
    if (this.readyState == 4 && this.status == 200) {
        //change the gamestate
        gamestate(id) = parseInt(this.responseText);
        //redraw
        draw();
    }
    request.open("POST", "", true);
    request.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
    request.send("id=" + id);
};

    }

</script>
<!-- faut remplacer les valeurs d'une facon ou d'une autre -->
<div id="parent" style="position: relative;max-width: 500px;max-height: 500px;">
<canvas id="field"  style="position: relative;left: 10px;top: 0px;z-index: -1;" width="500" height="500" ></canvas>
</div>

<script type="text/javascript">
    window.onload = charger;
</script>

</body>
</html>